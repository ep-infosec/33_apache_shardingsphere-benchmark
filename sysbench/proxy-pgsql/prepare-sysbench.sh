#!/bin/bash

BASE_PATH=$(sh toolkit/read-constant-from-file.sh .env "BASE_PATH")
SYSBENCH_RESULT=$(sh toolkit/read-constant-from-file.sh .env "SYSBENCH_RESULT")
SYSBENCH_GRAPH=$(sh toolkit/read-constant-from-file.sh .env "SYSBENCH_GRAPH")
SHARDING=$(sh toolkit/read-constant-from-file.sh .env "SHARDING")
READWRITE_SPLITTING=$(sh toolkit/read-constant-from-file.sh .env "READWRITE_SPLITTING")
SHADOW=$(sh toolkit/read-constant-from-file.sh .env "SHADOW")
ENCRYPT=$(sh toolkit/read-constant-from-file.sh .env "ENCRYPT")
SYSBENCH_GRAPH_PYTHON_FILE=$(sh toolkit/read-constant-from-file.sh .env "SYSBENCH_GRAPH_PYTHON_FILE")
SYSBENCH_PGSQL_SCRIPT=$(sh toolkit/read-constant-from-file.sh .env "SYSBENCH_PROXY_PGSQL_SCRIPT")
SYSBENCH_TEST_FUNCTION=$(sh toolkit/read-constant-from-file.sh .env "SYSBENCH_TEST_FUNCTION")
DATABASE_TYPE=$1
FOLDER_COUNT=$(sh toolkit/read-constant-from-file.sh .env "FOLDER_COUNT")
echo "${BASE_PATH}/${DATABASE_TYPE}/${SYSBENCH_RESULT}"

if [ ! -d "${BASE_PATH}/${DATABASE_TYPE}/${SYSBENCH_RESULT}" ]; then
  mkdir -p ${BASE_PATH}/${DATABASE_TYPE}/${SYSBENCH_RESULT}
  mkdir -p ${BASE_PATH}/${DATABASE_TYPE}/${SYSBENCH_RESULT}/${SYSBENCH_GRAPH}
  mkdir -p ${BASE_PATH}/${DATABASE_TYPE}/${SYSBENCH_RESULT}/${SHARDING}
  mkdir -p ${BASE_PATH}/${DATABASE_TYPE}/${SYSBENCH_RESULT}/${READWRITE_SPLITTING}
  mkdir -p ${BASE_PATH}/${DATABASE_TYPE}/${SYSBENCH_RESULT}/${SHADOW}
  mkdir -p ${BASE_PATH}/${DATABASE_TYPE}/${SYSBENCH_RESULT}/${ENCRYPT}

  mkdir ${BASE_PATH}/${DATABASE_TYPE}/${SYSBENCH_RESULT}/${SHARDING}/{1..15}
  mkdir ${BASE_PATH}/${DATABASE_TYPE}/${SYSBENCH_RESULT}/${READWRITE_SPLITTING}/{1..15}
  mkdir ${BASE_PATH}/${DATABASE_TYPE}/${SYSBENCH_RESULT}/${SHADOW}/{1..15}
  mkdir ${BASE_PATH}/${DATABASE_TYPE}/${SYSBENCH_RESULT}/${ENCRYPT}/{1..15}

  cp toolkit/${SYSBENCH_GRAPH_PYTHON_FILE} ${BASE_PATH}/${DATABASE_TYPE}/${SYSBENCH_RESULT}/${SYSBENCH_GRAPH_PYTHON_FILE}
  chmod +x ${BASE_PATH}/${DATABASE_TYPE}/${SYSBENCH_RESULT}/${SYSBENCH_GRAPH_PYTHON_FILE}

  mkdir -p ${BASE_PATH}/${DATABASE_TYPE}/${SYSBENCH_RESULT}/${SYSBENCH_GRAPH}/${SHARDING}
  mkdir -p ${BASE_PATH}/${DATABASE_TYPE}/${SYSBENCH_RESULT}/${SYSBENCH_GRAPH}/${READWRITE_SPLITTING}
  mkdir -p ${BASE_PATH}/${DATABASE_TYPE}/${SYSBENCH_RESULT}/${SYSBENCH_GRAPH}/${SHADOW}
  mkdir -p ${BASE_PATH}/${DATABASE_TYPE}/${SYSBENCH_RESULT}/${SYSBENCH_GRAPH}/${ENCRYPT}
fi

if [ ! -f "${BASE_PATH}/${DATABASE_TYPE}/${SYSBENCH_PGSQL_SCRIPT}" ]; then
  cp sysbench/${DATABASE_TYPE}/${SYSBENCH_PGSQL_SCRIPT} ${BASE_PATH}/${DATABASE_TYPE}/${SYSBENCH_PGSQL_SCRIPT}
  cp sysbench/${DATABASE_TYPE}/${SYSBENCH_TEST_FUNCTION} ${BASE_PATH}/${DATABASE_TYPE}/${SYSBENCH_TEST_FUNCTION}
fi